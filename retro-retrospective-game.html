<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïπÔ∏è RETRO RETROSPECTIVE ARCADE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }

        .crt-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.3) 100%);
            pointer-events: none;
            z-index: 999;
        }

        .arcade-cabinet {
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1e 100%);
            border: 8px solid #ff006e;
            border-radius: 20px;
            box-shadow: 
                0 0 20px #ff006e,
                0 0 40px #ff006e,
                inset 0 0 20px rgba(255, 0, 110, 0.2);
            max-width: 900px;
            width: 100%;
            position: relative;
        }

        .screen-bezel {
            background: #000;
            border: 6px solid #333;
            margin: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 30px rgba(0, 255, 255, 0.3);
        }


        .header {
            background: linear-gradient(180deg, #ff006e 0%, #8b0042 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 4px solid #00ffff;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #ffff00 0px,
                #ffff00 10px,
                #ff006e 10px,
                #ff006e 20px
            );
        }

        .title {
            font-size: 2em;
            color: #ffff00;
            text-shadow: 
                3px 3px 0 #ff006e,
                6px 6px 0 #00ffff;
            margin-bottom: 15px;
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            92% { transform: translate(-2px, 2px); }
            94% { transform: translate(2px, -2px); }
            96% { transform: translate(-2px, -2px); }
        }

        .subtitle {
            font-size: 0.8em;
            color: #00ffff;
            text-shadow: 2px 2px 0 #000;
        }

        .content {
            padding: 40px;
            min-height: 500px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: screenFadeIn 0.5s;
        }

        @keyframes screenFadeIn {
            from { opacity: 0; filter: blur(10px); }
            to { opacity: 1; filter: blur(0); }
        }

        .game-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .game-cartridge {
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            border: 4px solid #00ffff;
            padding: 25px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 100%, 5% 100%, 0 85%);
        }

        .game-cartridge:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
            border-color: #ffff00;
        }

        .game-cartridge::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: #ff006e;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }


        .cartridge-title {
            font-size: 1.2em;
            color: #ffff00;
            margin-bottom: 15px;
            text-shadow: 2px 2px 0 #000;
        }

        .cartridge-desc {
            font-size: 0.6em;
            color: #00ffff;
            line-height: 1.6;
        }

        .pixel-button {
            background: #ff006e;
            color: #ffff00;
            border: 4px solid #ffff00;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8em;
            cursor: pointer;
            position: relative;
            transition: all 0.1s;
            box-shadow: 4px 4px 0 #000;
            margin: 10px;
        }

        .pixel-button:hover {
            background: #ffff00;
            color: #ff006e;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .pixel-button:active {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 #000;
        }

        .level-display {
            background: #000;
            border: 4px solid #00ffff;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .level-number {
            font-size: 1.5em;
            color: #ffff00;
            text-shadow: 2px 2px 0 #ff006e;
        }

        .lives {
            color: #ff006e;
            font-size: 1.2em;
        }

        .score-display {
            color: #00ffff;
            font-size: 1em;
        }

        .question-box {
            background: #1a1a2e;
            border: 3px solid #00ffff;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .question-box::before {
            content: '‚ñ∂';
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            color: #ffff00;
            font-size: 1.5em;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .question-title {
            color: #ffff00;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .question-prompt {
            color: #00ffff;
            font-size: 0.7em;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .retro-textarea {
            width: 100%;
            min-height: 150px;
            background: #000;
            color: #00ff00;
            border: 3px solid #00ff00;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            resize: vertical;
        }

        .retro-textarea:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            animation: terminalGlow 2s infinite;
        }

        @keyframes terminalGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.8); }
        }


        .progress-bar-retro {
            background: #000;
            border: 3px solid #00ffff;
            height: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .progress-fill-retro {
            background: repeating-linear-gradient(
                90deg,
                #ff006e 0px,
                #ff006e 10px,
                #ffff00 10px,
                #ffff00 20px
            );
            height: 100%;
            transition: width 0.5s;
            position: relative;
        }

        .progress-fill-retro::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%
            );
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .game-over-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .game-over-title {
            font-size: 3em;
            color: #ff006e;
            text-shadow: 4px 4px 0 #000;
            margin-bottom: 20px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .final-score {
            font-size: 2em;
            color: #ffff00;
            margin: 20px 0;
        }

        .achievement {
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            border: 3px solid #00ffff;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .achievement-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .achievement-title {
            color: #ffff00;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .achievement-text {
            color: #00ffff;
            font-size: 0.6em;
            line-height: 1.6;
        }

        .coin-counter {
            display: inline-block;
            color: #ffff00;
            font-size: 1.2em;
            margin: 0 10px;
        }

        .coin-counter::before {
            content: '‚óè';
            color: #ffff00;
            margin-right: 5px;
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }


        .insert-coin {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffff00;
            font-size: 0.8em;
            animation: blink 1s infinite;
        }

        .power-up {
            display: inline-block;
            padding: 5px 10px;
            background: #ff006e;
            color: #ffff00;
            border: 2px solid #ffff00;
            margin: 5px;
            font-size: 0.6em;
        }

        .star-rating {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .star-btn {
            font-size: 3em;
            cursor: pointer;
            transition: all 0.3s;
            filter: grayscale(100%);
            opacity: 0.3;
        }

        .star-btn:hover {
            transform: scale(1.2) rotate(15deg);
            filter: grayscale(0%);
            opacity: 1;
        }

        .star-btn.selected {
            filter: grayscale(0%);
            opacity: 1;
            animation: starPulse 0.5s;
        }

        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(15deg); }
        }

        @media (max-width: 768px) {
            .title {
                font-size: 1.2em;
            }
            
            .game-select {
                grid-template-columns: 1fr;
            }
            
            .pixel-button {
                font-size: 0.6em;
                padding: 12px 20px;
            }
            
            .level-header {
                font-size: 0.8em;
            }
        }

        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: #fff;
            width: 2px;
            height: 2px;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <div class="crt-effect"></div>
    <div class="stars-bg" id="stars"></div>

    <div class="arcade-cabinet">
        <div class="screen-bezel">
            <div class="header">
                <div class="title">RETRO RETROSPECTIVE</div>
                <div class="subtitle">INSERT FEEDBACK TO CONTINUE</div>
            </div>

            <div class="content">
                <!-- Start Screen -->
                <div id="startScreen" class="screen active">
                    <div style="text-align: center; margin: 40px 0;">
                        <div style="font-size: 1.5em; color: #ffff00; margin-bottom: 30px;">
                            SELECT YOUR GAME
                        </div>
                    </div>

                    <div class="game-select">
                        <div class="game-cartridge" onclick="startGame('pacman')">
                            <div class="cartridge-title">üü° PAC-RETRO</div>
                            <div class="cartridge-desc">
                                Eat the good stuff, avoid the bad!
                                <br><br>
                                What to keep, what to avoid
                            </div>
                        </div>

                        <div class="game-cartridge" onclick="startGame('mario')">
                            <div class="cartridge-title">üçÑ SUPER SPRINT</div>
                            <div class="cartridge-desc">
                                Power-ups and obstacles!
                                <br><br>
                                What helped, what blocked
                            </div>
                        </div>

                        <div class="game-cartridge" onclick="startGame('spaceinvaders')">
                            <div class="cartridge-title">üëæ SPACE RETRO</div>
                            <div class="cartridge-desc">
                                Defend and attack!
                                <br><br>
                                Threats and opportunities
                            </div>
                        </div>

                        <div class="game-cartridge" onclick="startGame('tetris')">
                            <div class="cartridge-title">üü¶ TETRO-SPECT</div>
                            <div class="cartridge-desc">
                                Fit the pieces together!
                                <br><br>
                                What fit, what didn't
                            </div>
                        </div>
                    </div>

                    <div class="insert-coin">
                        ‚ñº PRESS START ‚ñº
                    </div>
                </div>


                <!-- Game Screen -->
                <div id="gameScreen" class="screen">
                    <div class="level-display">
                        <div class="level-header">
                            <div class="level-number" id="levelNumber">LEVEL 1</div>
                            <div class="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                            <div class="score-display">
                                SCORE: <span class="coin-counter" id="scoreValue">0</span>
                            </div>
                        </div>

                        <div class="progress-bar-retro">
                            <div id="progressBar" class="progress-fill-retro" style="width: 0%"></div>
                        </div>

                        <div id="questionContainer"></div>

                        <div class="button-group">
                            <button class="pixel-button" onclick="previousLevel()">
                                ‚óÄ BACK
                            </button>
                            <button class="pixel-button" onclick="returnToMainMenu()">
                                üè† MAIN MENU
                            </button>
                            <button class="pixel-button" onclick="nextLevel()">
                                NEXT ‚ñ∂
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Game Over Screen -->
                <div id="gameOverScreen" class="screen">
                    <div class="game-over-screen">
                        <div class="game-over-title">GAME COMPLETE!</div>
                        <div class="final-score">
                            FINAL SCORE: <span class="coin-counter" id="finalScore">0</span>
                        </div>

                        <div id="achievementsContainer"></div>

                        <div class="button-group">
                            <button class="pixel-button" onclick="downloadRetro()">
                                üíæ SAVE GAME
                            </button>
                            <button class="pixel-button" onclick="restartGame()">
                                üîÑ PLAY AGAIN
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let currentGame = '';
        let currentLevel = 0;
        let responses = {};
        let score = 0;

        // Game Configurations
        const games = {
            pacman: {
                name: 'PAC-RETRO',
                icon: 'üü°',
                levels: [
                    { id: 'power_pellets', title: '‚ö° POWER PELLETS', prompt: 'What gave us energy and power this sprint? What made us feel unstoppable?' },
                    { id: 'ghosts', title: 'üëª GHOSTS TO AVOID', prompt: 'What obstacles or problems should we avoid in the next sprint?' },
                    { id: 'dots', title: '‚Ä¢ DOTS TO COLLECT', prompt: 'What small wins or improvements should we keep collecting?' },
                    { id: 'maze', title: 'üó∫Ô∏è NAVIGATE THE MAZE', prompt: 'What path should we take next? What direction should we go?' },
                    { id: 'high_score', title: 'üèÜ HIGH SCORE GOAL', prompt: 'What would make the next sprint a record-breaking success?' },
                    { id: 'iteration_star', title: '‚≠ê ITERATION STAR', prompt: 'Rate this sprint (1-5 stars) and share your biggest takeaway or learning!', type: 'star_rating' }
                ]
            },
            mario: {
                name: 'SUPER SPRINT',
                icon: 'üçÑ',
                levels: [
                    { id: 'power_ups', title: 'üçÑ POWER-UPS', prompt: 'What tools, practices, or people powered us up this sprint?' },
                    { id: 'obstacles', title: 'üß± OBSTACLES', prompt: 'What blocks or barriers did we hit? What slowed us down?' },
                    { id: 'coins', title: 'ü™ô COINS COLLECTED', prompt: 'What valuable things did we gain or learn?' },
                    { id: 'pipes', title: 'üü¢ SECRET PIPES', prompt: 'What shortcuts or better ways of working did we discover?' },
                    { id: 'flag', title: 'üö© NEXT CASTLE', prompt: 'What is our next big goal or milestone?' },
                    { id: 'iteration_star', title: '‚≠ê ITERATION STAR', prompt: 'Rate this sprint (1-5 stars) and share your biggest takeaway or learning!', type: 'star_rating' }
                ]
            },
            spaceinvaders: {
                name: 'SPACE RETRO',
                icon: 'üëæ',
                levels: [
                    { id: 'invaders', title: 'ÔøΩ INVADERS', prompt: 'What threats sor risks are approaching? What do we need to defend against?' },
                    { id: 'shields', title: 'ÔøΩÔ∏è SHIELDS', prompt: 'What protections or safeguards do we have? What keeps us safe?' },
                    { id: 'laser', title: 'üî´ LASER SHOTS', prompt: 'What actions should we take to eliminate problems?' },
                    { id: 'ufo', title: 'üõ∏ BONUS UFO', prompt: 'What unexpected opportunities appeared? What bonus wins did we get?' },
                    { id: 'next_wave', title: 'üåä NEXT WAVE', prompt: 'What challenges do we expect in the next sprint?' },
                    { id: 'iteration_star', title: '‚≠ê ITERATION STAR', prompt: 'Rate this sprint (1-5 stars) and share your biggest takeaway or learning!', type: 'star_rating' }
                ]
            },
            tetris: {
                name: 'TETRO-SPECT',
                icon: 'üü¶',
                levels: [
                    { id: 'perfect_fit', title: '‚ú® PERFECT FIT', prompt: 'What pieces fit together perfectly? What worked really well?' },
                    { id: 'gaps', title: '‚¨ú GAPS LEFT', prompt: 'What gaps or missing pieces do we still have?' },
                    { id: 'line_clear', title: 'üí• LINE CLEARS', prompt: 'What problems did we completely eliminate or solve?' },
                    { id: 'wrong_piece', title: 'üîÑ WRONG PIECES', prompt: 'What didn\'t fit? What should we have done differently?' },
                    { id: 'next_piece', title: '‚è≠Ô∏è NEXT PIECE', prompt: 'What do we need next to succeed?' },
                    { id: 'iteration_star', title: '‚≠ê ITERATION STAR', prompt: 'Rate this sprint (1-5 stars) and share your biggest takeaway or learning!', type: 'star_rating' }
                ]
            }
        };

        // Initialize stars background
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        createStars();

        // Start Game
        function startGame(gameType) {
            currentGame = gameType;
            currentLevel = 0;
            responses = {};
            score = 0;

            playSound('start');
            
            document.getElementById('startScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            showLevel();
        }

        // Show Current Level
        function showLevel() {
            const game = games[currentGame];
            const level = game.levels[currentLevel];
            
            document.getElementById('levelNumber').textContent = 
                `LEVEL ${currentLevel + 1} - ${game.name}`;
            
            const savedResponse = responses[level.id] || '';
            
            if (level.type === 'star_rating') {
                const savedRating = responses[level.id + '_rating'] || 0;
                const savedComment = responses[level.id + '_comment'] || '';
                
                document.getElementById('questionContainer').innerHTML = `
                    <div class="question-box">
                        <div class="question-title">${level.title}</div>
                        <div class="question-prompt">${level.prompt}</div>
                        
                        <div style="text-align: center; margin: 30px 0;">
                            <div style="color: #ffff00; font-size: 0.8em; margin-bottom: 20px;">
                                CLICK TO RATE
                            </div>
                            <div class="star-rating" id="starRating">
                                ${[1, 2, 3, 4, 5].map(star => `
                                    <span class="star-btn ${star <= savedRating ? 'selected' : ''}" 
                                          onclick="selectStar(${star}, '${level.id}')"
                                          data-star="${star}">‚≠ê</span>
                                `).join('')}
                            </div>
                            <div style="color: #00ffff; font-size: 0.7em; margin-top: 15px;">
                                <span id="ratingText">${savedRating > 0 ? savedRating + ' STARS' : 'NO RATING'}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <div style="color: #ffff00; font-size: 0.8em; margin-bottom: 10px;">
                                BIGGEST TAKEAWAY
                            </div>
                            <textarea 
                                class="retro-textarea" 
                                id="response-${level.id}_comment"
                                placeholder="> SHARE YOUR KEY LEARNING_"
                                style="min-height: 100px;"
                            >${savedComment}</textarea>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('questionContainer').innerHTML = `
                    <div class="question-box">
                        <div class="question-title">${level.title}</div>
                        <div class="question-prompt">${level.prompt}</div>
                        <textarea 
                            class="retro-textarea" 
                            id="response-${level.id}"
                            placeholder="> TYPE YOUR RESPONSE HERE_"
                        >${savedResponse}</textarea>
                    </div>
                `;
            }
            
            updateProgress();
            updateScore();
        }


        // Save Current Response
        function saveCurrentResponse() {
            const game = games[currentGame];
            const level = game.levels[currentLevel];
            
            if (level.type === 'star_rating') {
                const commentTextarea = document.getElementById(`response-${level.id}_comment`);
                if (commentTextarea && commentTextarea.value.trim()) {
                    responses[level.id + '_comment'] = commentTextarea.value;
                }
                
                // Rating is saved via selectStar function
                const rating = responses[level.id + '_rating'] || 0;
                if (rating > 0 && !responses[level.id + '_scored']) {
                    score += rating * 50; // 50-250 points based on rating
                    responses[level.id + '_scored'] = true;
                    playSound('coin');
                }
            } else {
                const textarea = document.getElementById(`response-${level.id}`);
                if (textarea && textarea.value.trim()) {
                    responses[level.id] = textarea.value;
                    if (!responses[level.id + '_scored']) {
                        score += 100;
                        responses[level.id + '_scored'] = true;
                        playSound('coin');
                    }
                }
            }
        }

        // Select Star Rating
        function selectStar(rating, levelId) {
            responses[levelId + '_rating'] = rating;
            
            // Update visual stars
            document.querySelectorAll('.star-btn').forEach(star => {
                const starValue = parseInt(star.getAttribute('data-star'));
                if (starValue <= rating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
            
            // Update rating text
            document.getElementById('ratingText').textContent = rating + ' STARS';
            
            playSound('coin');
        }

        // Next Level
        function nextLevel() {
            saveCurrentResponse();
            
            const game = games[currentGame];
            
            if (currentLevel < game.levels.length - 1) {
                currentLevel++;
                playSound('jump');
                showLevel();
            } else {
                playSound('complete');
                showGameOver();
            }
        }

        // Previous Level
        function previousLevel() {
            saveCurrentResponse();
            
            if (currentLevel > 0) {
                currentLevel--;
                playSound('jump');
                showLevel();
            }
        }

        // Update Progress Bar
        function updateProgress() {
            const game = games[currentGame];
            const progress = ((currentLevel + 1) / game.levels.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Update Score
        function updateScore() {
            document.getElementById('scoreValue').textContent = score;
        }

        // Show Game Over Screen
        function showGameOver() {
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('gameOverScreen').classList.add('active');
            
            document.getElementById('finalScore').textContent = score;
            
            const game = games[currentGame];
            let achievementsHTML = '<div style="margin: 30px 0;">';
            
            game.levels.forEach(level => {
                if (level.type === 'star_rating') {
                    const rating = responses[level.id + '_rating'] || 0;
                    const comment = responses[level.id + '_comment'] || 'No comment provided';
                    const stars = '‚≠ê'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
                    
                    achievementsHTML += `
                        <div class="achievement">
                            <div class="achievement-icon">${game.icon}</div>
                            <div class="achievement-title">${level.title}</div>
                            <div style="color: #ffff00; font-size: 1.2em; margin: 10px 0;">
                                ${stars} (${rating}/5)
                            </div>
                            <div class="achievement-text">${comment}</div>
                        </div>
                    `;
                } else {
                    const response = responses[level.id] || 'No response';
                    achievementsHTML += `
                        <div class="achievement">
                            <div class="achievement-icon">${game.icon}</div>
                            <div class="achievement-title">${level.title}</div>
                            <div class="achievement-text">${response}</div>
                        </div>
                    `;
                }
            });
            
            achievementsHTML += '</div>';
            
            // Add power-ups earned
            const completedLevels = Object.keys(responses).filter(k => !k.includes('_scored')).length;
            achievementsHTML += '<div style="text-align: center; margin: 20px 0;">';
            achievementsHTML += '<div style="color: #ffff00; font-size: 1em; margin-bottom: 15px;">POWER-UPS EARNED</div>';
            
            if (completedLevels >= 5) {
                achievementsHTML += '<span class="power-up">üèÜ PERFECT CLEAR</span>';
            }
            if (completedLevels >= 3) {
                achievementsHTML += '<span class="power-up">‚≠ê TEAM PLAYER</span>';
            }
            if (score >= 500) {
                achievementsHTML += '<span class="power-up">üíé HIGH SCORER</span>';
            }
            
            achievementsHTML += '</div>';
            
            document.getElementById('achievementsContainer').innerHTML = achievementsHTML;
        }

        // Download Summary
        function downloadRetro() {
            const game = games[currentGame];
            let content = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n`;
            content += `‚ïë   ${game.name.toUpperCase()} - RETROSPECTIVE   ‚ïë\n`;
            content += `‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n`;
            content += `Date: ${new Date().toLocaleDateString()}\n`;
            content += `Final Score: ${score}\n`;
            content += `${'='.repeat(50)}\n\n`;
            
            game.levels.forEach((level, index) => {
                content += `LEVEL ${index + 1}: ${level.title}\n`;
                content += `${'-'.repeat(50)}\n`;
                content += `Question: ${level.prompt}\n\n`;
                
                if (level.type === 'star_rating') {
                    const rating = responses[level.id + '_rating'] || 0;
                    const comment = responses[level.id + '_comment'] || 'No comment provided';
                    const stars = '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
                    content += `Rating: ${stars} (${rating}/5)\n\n`;
                    content += `Takeaway:\n${comment}\n\n`;
                } else {
                    content += `Response:\n${responses[level.id] || 'No response provided'}\n\n`;
                }
                
                content += `${'='.repeat(50)}\n\n`;
            });
            
            content += `\nüéÆ GAME OVER - THANKS FOR PLAYING! üéÆ\n`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `retro-retrospective-${currentGame}-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            playSound('save');
        }

        // Restart Game
        function restartGame() {
            // Check if running in iframe (multiplayer mode)
            if (window.parent !== window) {
                // Send message to parent to reset session
                window.parent.postMessage({ action: 'resetSession' }, '*');
            } else {
                // Single player mode - just restart locally
                currentGame = '';
                currentLevel = 0;
                responses = {};
                score = 0;
                
                document.getElementById('gameOverScreen').classList.remove('active');
                document.getElementById('startScreen').classList.add('active');
                
                playSound('start');
            }
        }

        // Return to Main Menu
        function returnToMainMenu() {
            if (confirm('Return to main menu? Your progress will be lost.')) {
                currentGame = '';
                currentLevel = 0;
                responses = {};
                score = 0;
                
                document.getElementById('gameScreen').classList.remove('active');
                document.getElementById('startScreen').classList.add('active');
                
                playSound('start');
            }
        }

        // Sound Effects (using Web Audio API)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'start':
                    oscillator.frequency.value = 523.25; // C5
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
                case 'jump':
                    oscillator.frequency.value = 659.25; // E5
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'coin':
                    oscillator.frequency.value = 1046.50; // C6
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'complete':
                    [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.1);
                        osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                    });
                    break;
                case 'save':
                    oscillator.frequency.value = 440; // A4
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('gameScreen').classList.contains('active')) {
                if (e.key === 'ArrowRight' || e.key === 'Enter') {
                    e.preventDefault();
                    nextLevel();
                } else if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    previousLevel();
                }
            }
        });

        // Check for URL parameters to auto-start game
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const gameParam = urlParams.get('game');
            const autostart = urlParams.get('autostart');
            
            if (gameParam && autostart === 'true') {
                // Auto-start the specified game
                setTimeout(() => {
                    startGame(gameParam);
                }, 500);
            }
        });
    </script>
</body>
</html>
